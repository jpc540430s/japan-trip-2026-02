<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>OSAKA TRIP 2026</title>
    <!-- 若要更換桌面圖示，請修改下方 href 的網址即可 -->
    <link rel="apple-touch-icon" id="app-icon" href="https://i.ibb.co/tpQr2PBh/images.jpg">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;500;700;900&display=swap');
        body { font-family: 'Noto Sans JP', sans-serif; background-color: #F8F9FA; color: #333; font-size: 18px; }
        .card { background: white; border-radius: 20px; box-shadow: 0 4px 12px rgba(0,0,0,0.05); margin-bottom: 12px; border: 1px solid #EDEDED; overflow: hidden; }
        .time-badge { background: #444; color: white; padding: 3px 12px; border-radius: 8px; font-size: 15px; font-weight: bold; }
        .tab-content { display: none; padding-bottom: 120px; }
        .tab-content.active { display: block; }
        .nav-btn.active { color: #E91E63; border-top: 3px solid #E91E63; }
        .transit-card { background: #EBF2FF; border-left: 6px solid #3B82F6; padding: 12px 18px; margin: 8px 0; border-radius: 12px; }
        #guide-modal { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.7); z-index: 1000; align-items: flex-end; }
        .modal-body { background: white; width: 100%; border-radius: 25px 25px 0 0; padding: 25px; max-height: 85vh; overflow-y: auto; }
        .tag-red { background: #FFF0F0; color: #D32F2F; padding: 2px 8px; border-radius: 5px; font-size: 14px; font-weight: bold; margin-top: 5px; display: inline-block; }
    </style>
</head>
<body>

    <header class="sticky top-0 z-50 bg-white/90 backdrop-blur-md border-b p-4">
        <div class="flex justify-between items-center mb-4">
            <h1 class="text-xl font-black">OSAKA TRIP 2026</h1>
            <img src="https://img.izismile.com/img/img15/20240322/640/the_adorable_world_of_chiikawa_a_deep_dive_into_japans_latest_character_obsession_640_04.jpg" class="w-10 h-10 rounded-full">
        </div>
        <div class="flex overflow-x-auto space-x-2 no-scrollbar" id="day-tabs"></div>
    </header>

    <main class="p-4">
        <!-- Schedule Tab -->
        <div id="content-schedule" class="tab-content active">
            <a id="weather-link" href="#" target="_blank" class="card p-5 bg-gradient-to-r from-sky-400 to-blue-500 text-white border-none mb-6 block">
                <div class="flex justify-between items-center mb-3"><span id="weather-city" class="font-bold text-lg">正在載入地點...</span><span class="text-xs bg-white/20 px-2 py-1 rounded">點擊看詳情</span></div>
                <div class="flex justify-between text-center" id="weather-grid"></div>
            </a>
            <div id="itinerary-list"></div>
        </div>

        <!-- Tickets Tab -->
        <div id="content-tickets" class="tab-content">
            <h2 class="font-bold mb-4">我的票券</h2>
            <div id="ticket-list" class="space-y-4"></div>
            <label class="mt-4 block bg-gray-800 text-white text-center py-4 rounded-xl font-bold">
                <i class="fas fa-plus mr-2"></i>上傳票券照片
                <input type="file" class="hidden" accept="image/*" onchange="uploadImage(this, 'tickets')">
            </label>
        </div>

        <!-- Souvenirs Tab -->
        <div id="content-souvenirs" class="tab-content">
            <h2 class="font-bold mb-4">伴手禮筆記</h2>
            <div id="souvenir-list" class="grid grid-cols-2 gap-3"></div>
            <label class="mt-4 block bg-pink-500 text-white text-center py-4 rounded-xl font-bold">
                <i class="fas fa-camera mr-2"></i>新增照片/靈感
                <input type="file" class="hidden" accept="image/*" onchange="uploadImage(this, 'souvenirs')">
            </label>
        </div>

        <!-- Transit Tab -->
        <div id="content-transit" class="tab-content">
            <a href="https://maps.app.goo.gl/gjzi4PHy3W2tBmfj6" target="_blank" class="card p-6 block bg-green-600 text-white mb-4"><h3 class="font-bold">開啟 Google 自訂地圖</h3></a>
            <a href="https://www.navitime.co.jp/zh-tw/transfer/" target="_blank" class="card p-6 block bg-blue-600 text-white"><h3 class="font-bold">Navitime 換乘查詢</h3></a>
        </div>
    </main>

    <div id="guide-modal" onclick="closeModal()">
        <div class="modal-body" onclick="event.stopPropagation()">
            <h2 id="modal-title" class="text-2xl font-bold mb-4"></h2>
            <div id="modal-content" class="text-gray-600 space-y-4"></div>
            <button onclick="closeModal()" class="w-full mt-6 bg-gray-900 text-white py-4 rounded-xl">關閉</button>
        </div>
    </div>

    <nav class="fixed bottom-0 left-0 right-0 bg-white border-t flex justify-around p-2 pb-6 z-50">
        <button onclick="switchTab('schedule')" class="nav-btn active flex flex-col items-center"><i class="fas fa-calendar-alt text-xl"></i><span class="text-xs mt-1">行程</span></button>
        <button onclick="switchTab('tickets')" class="nav-btn flex flex-col items-center"><i class="fas fa-id-card text-xl"></i><span class="text-xs mt-1">票券</span></button>
        <button onclick="switchTab('souvenirs')" class="nav-btn flex flex-col items-center"><i class="fas fa-shopping-bag text-xl"></i><span class="text-xs mt-1">伴手禮</span></button>
        <button onclick="switchTab('transit')" class="nav-btn flex flex-col items-center"><i class="fas fa-route text-xl"></i><span class="text-xs mt-1">交通</span></button>
    </nav>

    <script>
        const guideBook = {
            "大阪城天守閣": { tip: "持周遊券免費。必看黃金茶室。", info: "大阪城由豐臣秀吉於1583年興建，現在看到的是重建後的博物館。" },
            "大阪城御座船": { tip: "周遊券免費。抵達先去劃位。", info: "以純金箔打造的觀光船。繞大阪城護城河約20分鐘。" },
            "牛たんの檸檬大阪本店": { tip: "必吃『極厚切牛舌定食』。", info: "東京新宿名店的大阪分店。選用穀物飼養牛舌，低溫熟成製作。" },
            "LOUTRE 大阪店": { tip: "預約制，水獺近距離互動。", info: "超人氣水獺咖啡廳，可以餵食與觸摸，記得動作要輕柔。" },
            "通天閣/四大天王/新世界商店街": { tip: "溜滑梯周遊券平日免費。", info: "建於1912年。周邊新世界區域以炸串與復古看板聞名。" },
            "HARUKAS 阿倍野展望台": { tip: "看夜景首選，300公尺高。", info: "日本第一高樓，擁有360度透明玻璃牆可俯瞰關西地區。" },
            "勝尾寺": { tip: "求勝運。買達摩御守。", info: "以達摩聞名的寺廟。信徒會買達摩寫下願望後留在寺內。" },
            "大鳥大社": { tip: "必買限量的『透明御守』。", info: "和泉國一之宮。透明御守象徵開運與勝利，在社群媒體極紅。" },
            "有馬溫泉(有馬案内所)": { tip: "金之湯、銀之湯。買碳酸煎餅。", info: "日本三大古泉。金泉富含鐵質，銀泉為碳酸泉。" },
            "麵包超人": { tip: "必買造型麵包。", info: "神戶人氣景點，可以看表演、買限定周邊並吃超萌麵包。" },
            "今昔館": { tip: "江戶街道，室內不怕雨。", info: "1:1 重現江戶時代大阪街道，有便宜的浴衣體驗。" },
            "天神筋商店街": { tip: "全日本最長。買中村屋可樂餅。", info: "全長 2.6 公里。集結上百家商店、餐廳與老店。" },
            "天滿宮": { tip: "求學業、求考試合格必去。", info: "供奉學問之神菅原道真。是大阪重要的文化信仰中心。" },
            "玄品 大阪 梅田東通": { tip: "必吃河豚火鍋粥，需預約。", info: "連鎖河豚專家，虎河豚刺身與火鍋非常道地。" },
            "富田林寺內町": { tip: "江戶老街。適合散策拍照。", info: "大阪府內唯一保存完好的重要傳統建築物群保護區。" }
        };

        const weatherData = {
            1: { city: "大阪 (KIX)", temps: [8, 12, 11, 9, 7], icon: "fa-cloud-sun" },
            2: { city: "大阪 (市區)", temps: [7, 13, 13, 10, 8], icon: "fa-sun" },
            3: { city: "箕面 (山區較冷)", temps: [4, 9, 8, 5, 3], icon: "fa-cloud" },
            4: { city: "神戶/有馬", temps: [3, 8, 7, 4, 2], icon: "fa-snowflake" },
            5: { city: "堺市/富田林", temps: [6, 12, 11, 8, 6], icon: "fa-sun" },
            6: { city: "大阪 (市區)", temps: [8, 14, 13, 10, 8], icon: "fa-sun" }
        };

        const itinerary = {
            1: [
                { time: "11:00", title: "出門", type: "move" },
                { time: "12:30", title: "桃園機場 T1 Airasia", type: "spot" },
                { time: "15:40", title: "TPE 起飛", type: "flight" },
                { time: "19:20", title: "KIX 降落", type: "flight" },
                { time: "20:20", title: "關西機場離開搭利木津巴士", type: "bus" },
                { time: "21:20", title: "check in大阪新阪急酒店別館", type: "hotel" }
            ],
            2: [
                { time: "08:30", title: "大阪新阪急酒店別館", type: "move" },
                { time: "09:15", title: "大阪城天守閣", type: "spot" },
                { time: "10:00", title: "大阪城御座船", type: "spot" },
                { time: "10:30", title: "大阪城逛逛", type: "spot" },
                { time: "12:30", title: "牛たんの檸檬大阪本店", type: "food" },
                { time: "14:00", title: "LOUTRE 大阪店", type: "spot" },
                { time: "15:00", title: "通天閣/四大天王/新世界商店街", type: "spot" },
                { time: "17:00", title: "HARUKAS 阿倍野展望台", type: "spot" },
                { time: "17:30", title: "備案：大阪高島屋", type: "spot" },
                { time: "21:00", title: "回飯店：大阪新阪急酒店別館", type: "hotel" }
            ],
            3: [
                { time: "08:00", title: "大阪新阪急酒店別館", type: "move" },
                { time: "08:45", title: "勝尾寺", type: "spot" },
                { time: "10:45", title: "大瀑布", type: "spot" },
                { time: "11:30", title: "瀧安寺", type: "spot" },
                { time: "13:00", title: "炸楓葉、足湯、案内所", type: "food" },
                { time: "13:30", title: "箕面車站吃飯", type: "food" },
                { time: "15:00", title: "梅田阪急逛街", type: "spot" },
                { time: "16:00", title: "吉伊卡哇LAND 大阪梅田店", type: "spot" },
                { time: "17:00", title: "KITTE大阪", type: "spot" },
                { time: "18:00", title: "4F 豊亨 吃飯", type: "food" },
                { time: "21:00", title: "回飯店：大阪新阪急酒店別館", type: "hotel" }
            ],
            4: [
                { time: "08:30", title: "大阪新阪急酒店別館", type: "move" },
                { time: "10:00", title: "有馬溫泉(有馬案内所)", type: "spot" },
                { time: "12:00", title: "有馬午餐", type: "food" },
                { time: "15:00", title: "麵包超人", type: "spot" },
                { time: "18:00", title: "神戶臨海樂園 umie", type: "spot" },
                { time: "20:00", title: "回飯店：大阪新阪急酒店別館", type: "hotel" }
            ],
            5: [
                { time: "07:23", title: "大阪新阪急酒店別館", type: "move" },
                { time: "08:10", title: "早餐：客美多咖啡 堺鳳店", type: "food" },
                { time: "09:00", title: "堺市 大鳥大社：透明御守", type: "spot" },
                { time: "11:00", title: "富田林寺內町", type: "spot" },
                { time: "12:00", title: "麺坊七福 寺内町店", type: "food" },
                { time: "16:30", title: "梅田", type: "spot" },
                { time: "19:00", title: "玄品 大阪 梅田東通", type: "food" },
                { time: "21:00", title: "回飯店：大阪新阪急酒店別館", type: "hotel" }
            ],
            6: [
                { time: "08:00", title: "大阪新阪急酒店別館", type: "move" },
                { time: "08:15", title: "Cafe Sunshine", type: "food" },
                { time: "09:00", title: "今昔館", type: "spot" },
                { time: "10:00", title: "天神筋商店街", type: "spot" },
                { time: "11:00", title: "天滿宮", type: "spot" },
                { time: "16:00", title: "大阪新阪急酒店別館離開搭利木津巴士", type: "bus" },
                { time: "17:00", title: "關西機場", type: "spot" },
                { time: "20:45", title: "KIX 起飛", type: "flight" },
                { time: "23:05", title: "降落", type: "flight" }
            ]
        };

        let currentDay = 1;

        function renderTabs() {
            const tabs = ["2/17(二)", "2/18(三)", "2/19(四)", "2/20(五)", "2/21(六)", "2/22(日)"];
            const container = document.getElementById('day-tabs');
            container.innerHTML = "";
            tabs.forEach((day, i) => {
                const btn = document.createElement('button');
                btn.className = `px-5 py-2 whitespace-nowrap rounded-full border-2 font-bold ${i+1 === currentDay ? 'bg-black text-white' : 'bg-white text-gray-500'}`;
                btn.innerText = day;
                btn.onclick = () => { currentDay = i + 1; updateUI(); };
                container.appendChild(btn);
            });
        }

        function updateUI() {
            renderTabs();
            const w = weatherData[currentDay];
            document.getElementById('weather-city').innerText = w.city;
            const grid = document.getElementById('weather-grid');
            grid.innerHTML = "";
            const hours = ["08:00", "12:00", "15:00", "18:00", "21:00"];
            w.temps.forEach((t, i) => {
                grid.innerHTML += `<div class="px-2"><p class="text-[10px] opacity-70">${hours[i]}</p><i class="fas ${w.icon} my-1"></i><p class="font-bold text-sm">${t}°</p></div>`;
            });

            const list = document.getElementById('itinerary-list');
            list.innerHTML = "";
            const items = itinerary[currentDay];

            items.forEach((item, idx) => {
                const guide = guideBook[item.title];
                let card = `<div class="card p-5" onclick="openModal('${item.title}')">
                    <div class="flex items-center gap-3">
                        <span class="time-badge">${item.time}</span>
                        <h3 class="font-bold text-lg">${item.title}</h3>
                    </div>
                    ${guide ? `<p class="tag-red"><i class="fas fa-lightbulb mr-1"></i> ${guide.tip}</p>` : ''}
                </div>`;
                list.innerHTML += card;

                if (idx < items.length - 1 && item.type !== 'flight') {
                    const next = items[idx + 1];
                    let link = `https://www.google.com/maps/dir/${item.title}/${next.title}/`;
                    let text = `導航往 ${next.title.substring(0,6)}`;
                    
                    // 利木津專屬邏輯
                    const isLimousine = item.title.includes("利木津") || next.title.includes("利木津");
                    if (isLimousine) {
                        link = "https://www.kate.co.jp/tcn/timetable/detail/UM";
                        text = "點此查看利木津巴士時刻表 (新阪急發車)";
                    }

                    list.innerHTML += `<a href="${link}" target="_blank" class="transit-card block">
                        <div class="flex justify-between items-center"><span class="text-sm font-bold"><i class="fas fa-train mr-2 text-blue-500"></i>${text}</span><i class="fas fa-chevron-right text-blue-300"></i></div>
                    </a>`;
                }
            });
        }

        function openModal(title) {
            const guide = guideBook[title];
            if (!guide) return;
            document.getElementById('modal-title').innerText = title;
            document.getElementById('modal-content').innerHTML = `<p>${guide.info}</p>`;
            document.getElementById('guide-modal').style.display = 'flex';
        }

        function closeModal() { document.getElementById('guide-modal').style.display = 'none'; }

        function switchTab(tabId) {
            document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
            document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
            document.getElementById('content-' + tabId).classList.add('active');
            event.currentTarget.classList.add('active');
            if(tabId === 'tickets' || tabId === 'souvenirs') renderGallery(tabId);
        }

        // --- 照片上傳與相簿管理功能 (恢復) ---
        function uploadImage(input, type) {
            const file = input.files[0];
            if (!file) return;
            const reader = new FileReader();
            reader.onload = function(e) {
                const name = prompt("請命名這張照片 (例如：大阪周遊券、炸楓葉)：", "未命名");
                if (name === null) return;
                const data = { id: Date.now(), src: e.target.result, name: name };
                let items = JSON.parse(localStorage.getItem(type) || "[]");
                items.push(data);
                localStorage.setItem(type, JSON.stringify(items));
                renderGallery(type);
            };
            reader.readAsDataURL(file);
        }

        function renderGallery(type) {
            const container = document.getElementById(type === 'tickets' ? 'ticket-list' : 'souvenir-list');
            container.innerHTML = "";
            let items = JSON.parse(localStorage.getItem(type) || "[]");
            items.forEach(item => {
                const div = document.createElement('div');
                div.className = "card bg-white shadow-sm overflow-hidden";
                div.innerHTML = `
                    <img src="${item.src}" class="w-full h-48 object-cover">
                    <div class="p-3 flex justify-between items-center">
                        <p class="font-bold text-sm truncate">${item.name}</p>
                        <div class="flex gap-3">
                            <button onclick="editName('${type}', ${item.id})" class="text-blue-500"><i class="fas fa-edit"></i></button>
                            <button onclick="deleteImg('${type}', ${item.id})" class="text-red-500"><i class="fas fa-trash"></i></button>
                        </div>
                    </div>`;
                container.appendChild(div);
            });
        }

        function editName(type, id) {
            let items = JSON.parse(localStorage.getItem(type));
            const item = items.find(i => i.id === id);
            const newName = prompt("修改名稱：", item.name);
            if (newName) {
                item.name = newName;
                localStorage.setItem(type, JSON.stringify(items));
                renderGallery(type);
            }
        }

        function deleteImg(type, id) {
            if(!confirm("確定刪除此照片？")) return;
            let items = JSON.parse(localStorage.getItem(type)).filter(i => i.id !== id);
            localStorage.setItem(type, JSON.stringify(items));
            renderGallery(type);
        }

        updateUI();
    </script>
</body>
</html>
